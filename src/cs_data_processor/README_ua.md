# {json: scada} cs_data_processor.js

Цей процес відповідає за перегляд оновлень об’єкта поля „sourceDataUpdate” з документів колекції „realtimeData” за допомогою потоку змін. Очікується, що всі джерела даних, такі як драйвери протоколу клієнта та механізм обчислення, оновлять дані до поля "sourceDataUpdate". Ця схема дозволяє максимально спростити драйвери протоколів та стандартизувати обробку даних у всіх джерелах лише в одному місці.

## Майбутні тригери даних

Розрахунок коефіцієнтів лінійного регулювання (a.x + b) або цифрової інверсії.
Оновлення основного документа "value", "valueString", "timeTag *", прапорці якості.
Перевірка цифрових (transition) та аналогових (limits violation) сигналів тривоги, сигналізації на полі "alarmed".
Оновлення колекції "soeData", коли для цифрових точок існує тег часу джерела.
Передача даних до історичної бази даних PostgreSQL.
Цей єдиний процес обробляє всі майбутні дані в режимі реального часу і може бути вузьким місцем для системи. Важливо спостерігати за затримкою та пропускною здатністю в системах з великим обсягом майбутніх даних. Великі затримки при обробці потоку змін можуть вимагати швидшого сервера або шардінгу.

Мітки часу "timeTag" та "sourceDataUpdate.timeTag" можна відняти, щоб знайти затримку потоку змін.

Приклад конвеєра для обчислення затримки (у мс)

[{
        '$match': {
        'group1': 'a group1 name'
        }
     }, {
        '$set': {
        'diff': {
            '$subtract': [
            '$timeTag', '$sourceDataUpdate.timeTag'
            ]
        }
        }
     }, {
        '$sort': {
        'diff': -1
        }
     }]

Потрібна Node.js.

## Обробити аргументи командного рядка та змінні середовища
Цей драйвер має такі аргументи командного рядка та еквівалентні змінні середовища.

1-й арг. - Номер екземпляра [Integer] - Номер екземпляра, який потрібно виконати. Необов’язковий аргумент, default=1. Env. змінна: JS_CSDATAPROC_INSTANCE.
2-й арг. - Журнал. Рівень [Integer] - Рівень журналу (0=minimum,1=basic,2=detailed,3=debug). Необов’язковий аргумент, default=1. Env. змінна: JS_CSDATAPROC_LOGLEVEL.
3-й арг. - Шлях/ім'я конфігураційного файлу [String] - Шлях/ім'я конфігураційного файлу JSON-SCADA. Необов’язковий аргумент, за default="../ conf / json-scada.json". Env. змінна: JS_CONFIG_FILE.
Аргументи командного рядка мають перевагу над змінними середовища.

## Збір екземплярів процесу
Якщо не знайдено, буде створено запис processInstance із типовими значеннями. Він може бути використаний для налаштування деяких параметрів та обмеження вузлів, дозволених для запуску екземплярів.

Дивитися також

 * [Документація схеми](../../docs/schema_ua.md)
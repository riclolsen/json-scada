# IEC 60870-5-104 Драйвер протоколу клієнта

Цей драйвер реалізує клієнт для протоколу IEC 104. За необхідності, він може мати кілька підключень до серверів IEC-104 на декількох комп’ютерах.

Для конфігурації драйвера необхідно створити один або кілька екземплярів драйвера і принаймні для підключення на кожен екземпляр. Також теги, призначені для оновлення, повинні бути налаштовані належним чином.

## Налаштуйте екземпляр драйвера

Щоб створити новий екземпляр клієнта IEC 104, вставте новий документ у колекцію _protocolDriverInsests_, використовуючи таку команду:

    use json_scada_db_name
    db.protocolDriverInstances.insert({
            protocolDriver: "IEC60870-5-104",
            protocolDriverInstanceNumber: 1,
            enabled: true,
            logLevel: 1,
            nodeNames: ["mainNode"], 
            activeNodeName: "mainNode",
            activeNodeKeepAliveTimeTag: new Date(),
            keepProtocolRunningWhileInactive: false
        });

* _**protocolDriver**_ [String] - ім'я драйвера протоколу, має бути "IEC60870-5-104".**Обов’язковий параметр**.
* _**protocolDriverInstanceNumber**_ [Double] - номер екземпляра. Використовуйте від 1 до N, щоб пронумерувати екземпляри. Для одного і того ж драйвера номери екземплярів повинні бути унікальними. Номер екземпляра дозволяє запустити використання кількох процесів драйвера, кожен з різною конфігурацією.**Обов’язковий параметр**.
* _**увімкнено**_ [Boolean] - керує ввімкненням екземпляра. Використовуйте тут false, щоб вимкнути екземпляр.**Обов’язковий параметр**.
* _**logLevel**_ [Double] - код номера для рівня журналу (0 = мінімальний, 1 = основний, 2 = детальний, 3 = налагоджений). Занадто багато реєстрації (рівні 2 та 3) може вплинути на продуктивність.**Обов’язковий параметр**.
* _**nodeNames**_ [Array of Strings] - масив імен вузлів, які можуть запускати екземпляр. Використовуйте більше одного вузла для надмірності. Кожен надлишковий екземпляр, що працює на окремих вузлах, матиме однакові підключення та дані, увімкнені для сканування та оновлення.**Обов’язковий параметр**.
* _**activeNodeName**_ [String] - ім'я драйвера протоколу, який активний на даний момент. Це оновлено драйверами для контролю надмірності.**Необов’язково**.
* _**activeNodeKeepAliveTimeTag**_ [Дата] - це регулярно оновлюється активним драйвером.**Необов’язково**.
* _**keepProtocolRunningWhileInactive**_ [Boolean] - Визначте драйвер, який буде підтримувати протокол, а не основний активний драйвер. В даний час підтримується лише значення _false_.**Необов’язково**.

Зміни в конфігурації _protocolDriverInsests_ вимагають перезапуску процесів екземплярів драйвера, щоб бути ефективними.

## Налаштуйте підключення клієнта до серверів IEC-104

У кожному екземплярі цього драйвера може бути визначено багато клієнтських підключень, які повинні бути описані в колекції _protocolConnections_.
використовуйте json_scada_db_name
    use json_scada_db_name
    db.protocolConnections.insert({
        protocolDriver: "IEC60870-5-104",
        protocolDriverInstanceNumber: 1,
        protocolConnectionNumber: 61,
        name: "KAW2",
        description: "KAW2 Station IEC-104",
        enabled: true,
        commandsEnabled: true,
        ipAddressLocalBind: "", 
        ipAddresses: ["192.168.0.21:2404"],
        localLinkAddress: 1,
        remoteLinkAddress: 205,
        giInterval: 300,
        testCommandInterval: 5,
        timeSyncInterval: 650,
        sizeOfCOT: 2,
        sizeOfCA: 2,
        sizeOfIOA: 3,
        k: 12,
        w: 8,
        t0: 10,
        t1: 15,
        t2: 10,
        t3: 20,
        stats: null
    });

* _**protocolDriver**_ [String] - ім'я драйвера протоколу, має бути "IEC60870-5-104".**Обов’язковий параметр**.
* _**protocolDriverInstanceNumber**_ [Double] - номер екземпляра. Використовуйте від 1 до N, щоб пронумерувати екземпляри. Для одного і того ж драйвера номери екземплярів повинні бути унікальними. Номер екземпляра дозволяє запустити використання кількох процесів драйвера, кожен з різною конфігурацією.**Обов’язковий параметр**.
* _**protocolConnectionNumber**_ [Double] - Номерний номер для підключення протоколу. Це повинно бути унікальним для всіх підключень усіх драйверів системи. Цей номер використовується для визначення з'єднання, яке може оновити тег.**Обов’язковий параметр**.
* _**ім'я**_ [String] - Ім'я для з'єднання. Використовуватиметься для лісозаготівлі.**Обов’язковий параметр**.
* _**опис**_ [String] - Опис з метою підключення. Просто документально.**Необов’язковий параметр**.
* _**увімкнено**_ [Boolean] - керує ввімкненням з'єднання. Використовуйте тут false, щоб вимкнути з’єднання.**Обов’язковий параметр**.
* _**commandEnabled**_ [Boolean] - Дозволяє вимкнути команди (повідомлення в напрямку управління) для з'єднання. Використовуйте тут false, щоб вимкнути команди.**Обов’язковий параметр**.
* _**ipAddressLocalBind**_ [String] - Не використовується для цього драйвера.**Необов’язковий параметр**.
* _**ipAddresses**_ [Array String] - масив IP-адрес та портів для серверів IEC-104, які слід перевірити (наразі підтримується лише перший сервер).**Обов’язковий параметр**.
* _**localLinkAddress**_ [Double] - Місцева адреса посилання для з'єднання (адреса ініціатора).**Обов’язковий параметр**.
* _**remoteLinkAddress**_ [Double] - Адреса віддаленого посилання сервера (адреса ініціатора).**Необов’язковий параметр**.
* _**giInterval**_ [Double] - період опитування загальної станції в секундах.**Необов’язковий параметр**.
* _**testCommandInterval**_ [Double] - Інтервал для надсилання повідомлень про тестові команди за лічені секунди. Використовуйте нуль, щоб вимкнути повідомлення тестових команд.**Необов’язковий параметр**.
* _**timeSyncInterval**_ [Double] - інтервал часу в секундах для надсилання повідомлень про синхронізацію часу. Використовуйте нуль, щоб вимкнути.**Обов’язковий параметр**.
* _**sizeOfCOT**_ [Double] - Розмір поля протоколу причини передачі в байтах (1 або 2).**Обов’язковий параметр**.
* _**sizeOfCA**_ [Double] - Розмір поля протоколу командної адреси в байтах (1 або 2).**Обов’язковий параметр**.
* _**sizeOfIOA**_ [Double] - Розмір поля протоколу адреси інформаційного об'єкта в байтах (1, 2 або 3).**Обов’язковий параметр**.
* _**k**_ [Double] - параметр протоколу _k_.**Обов’язковий параметр**.
* _**w**_ [Double] - параметр протоколу _w_.**Обов’язковий параметр**.
* _**t0**_ [Double] - час очікування протоколу _t0_ у секундах.**Обов’язковий параметр**.
* _**t1**_ [Double] - час очікування протоколу _t1_ у секундах.**Обов’язковий параметр**.
* _**t2**_ [Double] - час очікування протоколу _t2_ у секундах.**Обов’язковий параметр**.
* _**t3**_ [Double] - час очікування протоколу _t3_ у секундах.**Обов’язковий параметр**.
* _**статистика**_ [Double] - статистика протоколу, оновлена ​​драйвером.**Обов’язковий параметр**.

## Налаштуйте теги для оновлення

Кожен тег, який потрібно оновити під час з’єднання, повинен мати налаштований джерело протоколу.
Оновити тег може лише одне джерело.

Виберіть тег для оновлення підключення, як показано нижче.

    use json_scada_db_name
    db.realtimeData.updateOne({"tag":"A_TAG_NAME"}, {
        $set: {
            protocolSourceConnectionNumber: 61,
            protocolSourceCommonAddress: 205,
            protocolSourceObjectAddress: 1000,
            protocolSourceASDU: 13,
            protocolSourceCommandDuration: 0,
            protocolSourceCommandUseSBO: false,
            kconv1: 1,
            kconv2: 0
            }
    });

* _**protocolConnectionNumber**_ [Double] - Номерний номер для підключення протоколу. Тільки це з'єднання протоколу може оновити тег.**Обов’язковий параметр**.
* _**protocolSourceCommonAddress**_ [Double] - загальна адреса ASDU. В одному з'єднанні може бути більше однієї загальної адреси.**Обов’язковий параметр**.
* _**protocolSourceObjectAddress**_ [Double] - адреса об’єкта. Ця адреса в поєднанні з _protocolSourceCommonAddress_ повинна бути унікальною для з'єднання.**Обов’язковий параметр**.
* _**protocolSourceASDU**_ [Double] - Тип джерела ASDU TI. Це документально, драйвер протоколу оновить тег, використовуючи будь-який підтримуваний тип ASDU.**Обов’язковий параметр**.
* _**protocolSourceCommandDuration**_ [Double] - Параметри команд, поле IEC-104 QU: 0 = Не вказано, 1 = Короткий імпульс, 2 = Тривалий імпульс, 3 = Постійний. Просто значущий для команд.**Обов’язковий параметр**.
* _**protocolSourceCommandUseSBO**_ [Double] - Використовуйте послідовність керування Select-Before-Operate. Просто значущий для команд.**Обов’язковий параметр**.
* _**kconv1**_ [Double] - Аналоговий коефіцієнт перетворення: множник. Використовуйте -1 для інвертування цифрових значень.**Обов’язковий параметр**.
* _**kconv2**_ [Double] - Аналоговий коефіцієнт перетворення: суматор.**Обов’язковий параметр**.